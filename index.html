<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>График Bitcoin (BTC/USDT)</title>
<!-- Подключаем Chart.js из CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  body {
    background-color: #000;
    color: #fff;
    font-family: Arial, sans-serif;
    margin: 20px;
    text-align: center;
  }

  h1 {
    margin-bottom: 20px;
  }

  /* Контейнер для графика — задаем высоту 700px (можете увеличить по желанию) */
  #chartContainer {
    width: 90%;
    max-width: 900px;
    height: 700px; /* увеличили высоту */
    margin: auto;
    display: flex;
    flex-direction: column;
  }

  /* Canvas растягивается по высоте контейнера */
  canvas {
    flex: 1;
    width: 100% !important; /* обеспечиваем адаптивность по ширине */
    height: 100% !important; /* растягиваем по высоте контейнера */
    background-color: #222;
    border-radius: 8px;
  }
</style>
</head>
<body>

<h1>Bitcoin (BTC/USDT) за последние 24 часа</h1>
<div id="chartContainer">
  <canvas id="myChart"></canvas>
</div>

<script>
// Функция для загрузки данных с Binance
async function fetchData() {
  const response = await fetch('https://api.binance.com/api/v3/klines?symbol=BTCUSDT&interval=1m&limit=1440');
  const data = await response.json();
  
  // Обработка данных
  const labels = [];
  const prices = [];
  data.forEach(item => {
    const openTime = new Date(item[0]);
    const hours = openTime.getHours().toString().padStart(2, '0');
    const minutes = openTime.getMinutes().toString().padStart(2, '0');
    labels.push(`${hours}:${minutes}`);
    prices.push(parseFloat(item[4])); // Цена закрытия
  });
  return { labels, prices };
}

// Создаем график после загрузки данных
async function createChart() {
  const { labels, prices } = await fetchData();

  const ctx = document.getElementById('myChart').getContext('2d');

  // Удаляем предыдущий график, если он есть, чтобы не накладывался при обновлении
  if(window.chartInstance) {
    window.chartInstance.destroy();
  }

  window.chartInstance = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Цена (USDT)',
        data: prices,
        borderColor: 'red',
        backgroundColor: 'rgba(255,0,0,0.2)',
        fill: true,
        pointRadius: 0,
        tension: 0.4,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false, // важно — высота задается через CSS
      scales: {
        x: {
          grid: {
            color: '#444'
          },
          ticks: {
            color: '#fff'
          }
        },
        y: {
          grid: {
            color: '#444'
          },
          ticks: {
            color: '#fff'
          }
        }
      },
      plugins: {
        legend: {
          labels: {
            color: '#fff'
          }
        },
        tooltip: {
          backgroundColor: '#333',
          titleColor: '#fff',
          bodyColor: '#fff'
        }
      }
    }
  });
}

// Запускаем создание графика при загрузке страницы
createChart();
</script>

</body>
</html>
